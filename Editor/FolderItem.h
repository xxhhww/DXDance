#pragma once
#include "BrowserItem.h"
#include <map>

namespace App {
	/*
	* 文件夹项目
	*/
	class FolderItem : public BrowserItem {
	public:
		/*
		* 构造函数
		*/
		FolderItem(const std::string& name, const std::string& path);

		/*
		* 创建浏览器项目
		*/
		template<typename T, typename ...Args>
		inline T& CreateBrowserItem(Args&&... args) {
			static_assert(std::is_base_of<BrowserItem, T>::value, "T should derive from BrowserItem");
			T* item = new T(args...);
			mBrowserItems.emplace(item->name, item);
			return *item;
		}

		/*
		* 修改Key
		*/
		void UpdateKey(const std::string& oldKey, const std::string& newKey);

		/*
		* 传播新的路径信息
		*/
		void PropagatePath(const std::string& parentPath) override;

		/*
		* 删除被标记为销毁的Widget
		*/
		void DoDestruction();

		/*
		* Get方法
		*/
		auto& GetBrowserItems() { return mBrowserItems; }
		const auto& GetBrowserItems() const { return mBrowserItems; }

	protected:
		void _Draw_Internal_Impl() override;
	public:
		Tool::Event<> openedEvent;
		Tool::Event<> closedEvent;
		Tool::Event<> clickedEvent;
		Tool::Event<> doubleClickedEvent;

		bool opened{ false };	// 文件夹项目是否打开
	protected:
		std::map<std::string, std::unique_ptr<BrowserItem>> mBrowserItems;	// 子项目
		std::vector<std::pair<std::string, std::string>>	mkeyUpadtes;	// Key更新
	};
}